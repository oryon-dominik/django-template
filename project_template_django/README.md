# {{ project_name }}

> Describe your project's elevator pitch here

---

Add some more detailed information about your project as well.

---


**Read the project's [documentation](./documentation/index.md) for all details and how-to's.**  

Realised as a [django](https://www.djangoproject.com/) project.  
Generated by
```shell
django-admin startproject --template https://github.com/oryon-dominik/django-template/releases/download/latest/project_template_django.zip --extension=py,md,toml,yaml,yml,env,. {{ project_name }} .
```

Project dependencies are managed by [poetry](https://python-poetry.org/).  

## TLDR

```powershell
# python + venv
poetry install
workon

# setup the project locally
pre-commit install

# secret envs from doppler.com (via scoop installation)
irm get.scoop.sh | iex
scoop bucket add doppler https://github.com/DopplerHQ/scoop-doppler.git
doppler login
doppler setup
```

```powershell
# If nobody did it, import the settings to doppler
doppler import
```

```powershell
(doppler secrets download --format=json --no-file --config=dev | ConvertFrom-Json | ForEach-Object { $_.PSObject.Properties } | ForEach-Object { "$($_.Name)=$($_.Value)" }) -join "`n" | Out-File './envs/develop.env'
(doppler secrets download --format=json --no-file --config=test | ConvertFrom-Json | ForEach-Object { $_.PSObject.Properties } | ForEach-Object { "$($_.Name)=$($_.Value)" }) -join "`n" | Out-File './envs/test.env'
# hint for custom settings: doppler configure set config=dev_snowflake

cc init
podman compose -f containers/postgres-and-redis.yml up
cc migrate
python manage.py createcachetable

# run the project tests, once
pytest

# create a testuser
python manage.py shell
$ from django.contrib.auth import get_user_model
$ email = "test@example.com"
$ User = get_user_model()
$ user = User.objects.create(username=email, email=email, is_active=True)
$ user.set_password("test")
$ user.save()

podman compose -f containers/postgres-and-redis.yml up -d
python manage.py runserver
```


## Setup & developing

- [How-to-clone-and-ssh](./documentation/for-developers/how-to-clone-and-ssh.md).
- [How-to-develop basics](./documentation/for-developers/how-to-develop.md).
- [jupyter notebooks for fast debugging](./documentation/for-developers/notebooks.md).


### Install dependencies

    # either install all requirements
    poetry install

    # cherry pick the ones you need
    poetry install --with authentication,restframework,vite --without postgres,paragons

    # or install only the root dependencies (updating the lock file)
    poetry install --only-root --sync


### Contributors

Please add yourself.  
Auto-create a [CONTRIBUTERS.txt](https://github.com/Pierre-Sassoulas/contributors-txt),
using aliases defined in `config/contributors/aliases.json` from the contributors in git.

    contributors-txt --aliases .\config\contributors\aliases.json


### Setup the project

    python commands.py setup
    python manage.py migrate


### Deployment

See the [documentation on deployments](./documentation/for-devops/deployment.md) for details.


### Pre-Commit hooks

[Pre-commit hooks](https://github.com/pre-commit/pre-commit-hooks) are defined
in `.pre-commit-config.yaml`. Adding them to the project will ensure that the
code is formatted and linted before committing. Repeat the installation
everytime you re-create the venv  

    pre-commit install

TODO: reactivate pyupgrade after the support for typing.Optional is added in 1.0 of typer


### Tests

Run [pytest](https://docs.pytest.org/).

    pytest


### Linter

Lint with [ruff](https://github.com/charliermarsh/ruff) and [flake8](https://github.com/PyCQA/flake8).

    ruff check .
    flake8


### Formatter

Autoformatting is enforced with industry-standard [black](https://github.com/psf/black).

    black --check .


### Type checker

Static type checking can be checked with [mypy](https://mypy-lang.org/).

    mypy --config-file pyproject.toml .

To let the mypy daemon (dmypy) work with your ide, install the following packages in the env, that is used by your ide:

    pip install mypy django-stubs[compatible-mypy] django-stubs-ext django djangorestframework djangorestframework-stubs[compatible-mypy]


### Tailwind-Frontend

    scoop install main/tailwindcss
    python manage.py tailwind watch

```html
{% verbatim %}{% load tailwind_cli %}{% endverbatim %}
...
<head>
  ...
  {% verbatim %}{% tailwind_css %}{% endverbatim %}
  ...
</head>

<p class="text-red-700">style me</p>
```

### gitflow

See the [documentation on releases](./documentation/releases.md) for details.


### containerized postgresql

- [postgres](https://www.postgresql.org/)
- [podman](https://podman.io/)
- [postgres image on dockerhub](https://hub.docker.com/_/postgres)

You might want to use the postgres container inside `containers/postgres.yml`  
Be aware that no other (local) postgres shall be running on the same port (`5432`), otherwise the container is known to introduce some hard to find conflicts - especially on windows machines using *wsl* as the hypervisor.  

Build and run

    podman compose -f containers/postgres.yml build
    podman compose -f containers/postgres.yml up

Bash-shell to container

    podman exec -it postgres /bin/bash

Edit `pg_hba.conf`

    apt-get update && apt install -y vim && vim /var/lib/postgresql/data/pg_hba.conf

DB-shell

    # linux
    podman compose run postgres psql -h localhost -U developer -d {{ project_name }}
    # windows
    podman compose run postgres psql -h host.containers.internal -U developer -d {{ project_name }}


### redis via podman

- [redis](https://redis.io/)

Build and run

    podman compose -f containers/redis.yml build
    podman compose -f containers/redis.yml up

Redis-shell

    podman exec -it {{ project_name }}_redis redis-cli

        > auth <password>
        OK

        > ping
        PONG


### postgres + redis via podman

Build and run

    podman compose -f containers/postgres-and-redis.yml build
    podman compose -f containers/postgres-and-redis.yml up

For single usage, combine the containers, you need -- the specific commands are still valid.


### celery

- [celery](https://docs.celeryq.dev/) & [celery-beat](https://github.com/celery/django-celery-beat)

(develop) start the beat, who can't live without the worker

    $env:DJANGO_SETTINGS_MODULE="config.settings.develop"; celery --app config.celeryapp beat --loglevel=INFO

(develop) start the worker (threadpool on windows is solo!)

    $env:DJANGO_SETTINGS_MODULE="config.settings.develop"; celery --app config.celeryapp worker --loglevel=INFO --queues {{ project_name }},celery --pool solo

Ocassionally it's good to purge all (old) celery tasks

    # set DJANGO_SETTINGS_MODULE environment variable
    $env:DJANGO_SETTINGS_MODULE="config.settings.develop"  # powershell
    DJANGO_SETTINGS_MODULE=config.settings.develop  # posix

    # Then purge all tasks from queues celery and {{ project_name }}
    $env:DJANGO_SETTINGS_MODULE="config.settings.develop"; celery --app config.celeryapp purge --queues {{ project_name }},celery


## Preinstalled third party packages

### root (default)
- [msgspec](https://jcristharif.com/msgspec/)

### develop
- [jupyter](https://jupyter.org/)
- [typer](https://typer.tiangolo.com/)
- [ruff](https://github.com/charliermarsh/ruff)
- [pytest](https://docs.pytest.org/)
- [faker](https://faker.readthedocs.io/en/master/)

### django
- [django-readers](https://www.django-readers.org/)
- [django-hatchway](https://github.com/andrewgodwin/django-hatchway)
- [django-cripsy-forms](https://django-crispy-forms.readthedocs.io/)

### paragons
- [rich](https://github.com/Textualize/rich)
- [humanize](https://python-humanize.readthedocs.io/)
- [pendulum](https://pendulum.eustace.io/)
- [dill](https://github.com/uqfoundation/dill)
- [passlib](https://passlib.readthedocs.io/en/stable/)
- [httpx](https://www.python-httpx.org/)

### restframework
- [djangorestframework](https://www.django-rest-framework.org/)

### authentication
- [jose](https://github.com/mpdavis/python-jose)

### vite
- [django-vite](https://github.com/MrBin99/django-vite)

and many more..
